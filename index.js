var jsmodule=function(e){function t(t){for(var n,r,i=t[0],a=t[1],c=0,s=[];c<i.length;c++)r=i[c],Object.prototype.hasOwnProperty.call(o,r)&&o[r]&&s.push(o[r][0]),o[r]=0;for(n in a)Object.prototype.hasOwnProperty.call(a,n)&&(e[n]=a[n]);for(l&&l(t);s.length;)s.shift()()}var n={},o={0:0};var r={};var i={2:function(){return{"./index.js":{__wbindgen_string_new:function(e,t){return n[1].exports.__wbindgen_string_new(e,t)},__wbindgen_object_drop_ref:function(e){return n[1].exports.__wbindgen_object_drop_ref(e)},__wbg_call_34f87007c5d2a397:function(e,t,o){return n[1].exports.__wbg_call_34f87007c5d2a397(e,t,o)},__wbindgen_debug_string:function(e,t){return n[1].exports.__wbindgen_debug_string(e,t)},__wbindgen_throw:function(e,t){return n[1].exports.__wbindgen_throw(e,t)}}}}};function a(t){if(n[t])return n[t].exports;var o=n[t]={i:t,l:!1,exports:{}};return e[t].call(o.exports,o,o.exports,a),o.l=!0,o.exports}a.e=function(e){var t=[],n=o[e];if(0!==n)if(n)t.push(n[2]);else{var c=new Promise((function(t,r){n=o[e]=[t,r]}));t.push(n[2]=c);var s,d=document.createElement("script");d.charset="utf-8",d.timeout=120,a.nc&&d.setAttribute("nonce",a.nc),d.src=function(e){return a.p+""+({}[e]||e)+".js"}(e);var l=new Error;s=function(t){d.onerror=d.onload=null,clearTimeout(u);var n=o[e];if(0!==n){if(n){var r=t&&("load"===t.type?"missing":t.type),i=t&&t.target&&t.target.src;l.message="Loading chunk "+e+" failed.\n("+r+": "+i+")",l.name="ChunkLoadError",l.type=r,l.request=i,n[1](l)}o[e]=void 0}};var u=setTimeout((function(){s({type:"timeout",target:d})}),12e4);d.onerror=d.onload=s,document.head.appendChild(d)}return({1:[2]}[e]||[]).forEach((function(e){var n=r[e];if(n)t.push(n);else{var o,c=i[e](),s=fetch(a.p+""+{2:"1d3609865253e5530e4f"}[e]+".module.wasm");if(c instanceof Promise&&"function"==typeof WebAssembly.compileStreaming)o=Promise.all([WebAssembly.compileStreaming(s),c]).then((function(e){return WebAssembly.instantiate(e[0],e[1])}));else if("function"==typeof WebAssembly.instantiateStreaming)o=WebAssembly.instantiateStreaming(s,c);else{o=s.then((function(e){return e.arrayBuffer()})).then((function(e){return WebAssembly.instantiate(e,c)}))}t.push(r[e]=o.then((function(t){return a.w[e]=(t.instance||t).exports})))}})),Promise.all(t)},a.m=e,a.c=n,a.d=function(e,t,n){a.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},a.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},a.t=function(e,t){if(1&t&&(e=a(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(a.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var o in e)a.d(n,o,function(t){return e[t]}.bind(null,o));return n},a.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return a.d(t,"a",t),t},a.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},a.p="",a.oe=function(e){throw console.error(e),e},a.w={};var c=window.webpackJsonpjsmodule=window.webpackJsonpjsmodule||[],s=c.push.bind(c);c.push=t,c=c.slice();for(var d=0;d<c.length;d++)t(c[d]);var l=s;return a(a.s=0)}([function(e,t,n){"use strict";n.r(t),n.d(t,"getPaperDocs",(function(){return w}));const o=n.e(1).then(n.bind(null,1)),r=(i={},a=[],c=0,s=function(e){return function(t){if(!i.hasOwnProperty(t)){const d=t.match(/_([^_]+?_*)\.(png|jpg|jpeg|svg)$/i);if(d){const l=d[1];var n="."+d[2].toLowerCase();const u=".svg"===n;u&&(n=".png");for(var o=l+n,r=2;a.indexOf(o)>=0;)o=l+"-"+r+n,r+=1;a.push(o);const m=c;var s=p(t,"GET","arraybuffer").then(e=>e.response);u&&(s=s.then(e=>{if(c===m)return function(e){return new Promise((t,n)=>{var o=document.createElement("canvas"),r=new Image;r.style="max-width:2000px;max-height:3000px",r.onload=function(){o.setAttribute("width",""+r.width),o.setAttribute("height",""+r.height),o.getContext("2d").drawImage(r,0,0,r.width,r.height),URL.revokeObjectURL(r.src),o.toBlob(e=>{const n=new FileReader;n.onload=e=>{t(e.target.result)},n.readAsArrayBuffer(e)},"image/png")};const i=new Blob([e],{type:"image/svg+xml"});r.src=window.URL.createObjectURL(i)})}(e)})),i[t]=s.then(n=>{c===m&&e.register_image(t,o,new Uint8Array(n))})}}}},{markdownToLatex:function(e,t){i={},a=[],c+=1,document.getElementById("save-zip-container").style.display="none";try{URL.revokeObjectURL(document.getElementById("save-zip").href)}catch(e){}const n=t.markdown_to_latex(e,s(t));if(0!==a.length){document.getElementById("wait-zip").style.display="inline";const n=c;Promise.all(Object.values(i)).then((function(){if(c===n){const n=t.markdown_to_zipped_latex(e),o=new Blob([n],{type:"application/zip"}),r=window.URL.createObjectURL(o);document.getElementById("save-zip").href=r,document.getElementById("wait-zip").style.display="none",document.getElementById("save-zip-container").style.display="inline"}}))}else document.getElementById("wait-zip").style.display="none";return n},generateZipFile:function(e){return e.markdown_to_zipped_latex(markdown)}});var i,a,c,s;const d=(l=null,function(e){e.preventDefault();const t="https://www.dropbox.com/oauth2/authorize?client_id=ebapspmlhsl9rn9&response_type=token&redirect_uri=https%3A%2F%2Frobamler.github.io%2Fbluepaper%2Foauth-redirect.html&state=remember%3D"+!!document.getElementById("remember").checked;null===l||l.closed?null===(l=window.open(t,"authorize","width=730,height=700,location,status,resizable,scrollbars"))&&(location.href=t):l.focus()});var l;function u(e){const t=e.dataTransfer.items;1===t.length&&"file"===t[0].kind&&(e.stopPropagation(),e.preventDefault(),document.getElementById("drop-feedback").style.display="block",document.getElementById("main").classList.add("blurred"),e.dataTransfer.dropEffect="copy")}function m(e){e.stopPropagation(),e.preventDefault(),document.getElementById("drop-feedback").style.display="none",document.getElementById("main").classList.remove("blurred")}function p(e,t,n,o,r){return new Promise((function(i,a){var c=new XMLHttpRequest;c.open(t,e,!0),void 0!==n&&(c.responseType=n),void 0!==o&&c.setRequestHeader("Content-Type",o),c.onreadystatechange=function(e){this.readyState===XMLHttpRequest.DONE&&(this.status>=200&&this.status<300?i(this):a(this))},c.send(r||null)}))}async function f(e){const t=await function(e){return new Promise((function(t,n){var o=new FileReader;o.onload=function(e){return t(e.target.result)},o.readAsText(e)}))}(e),n=await o,i=r.markdownToLatex(t,n);I(),document.querySelector(".result").classList.add("solo"),document.getElementById("first-step-doclist").style.display="none";var a=document.getElementById("latex");a.value=i,setTimeout((function(){a.scrollTo(0,0)}),0)}function y(e){m(e);const t=e.dataTransfer.items;1===t.length&&"file"===t[0].kind&&f(e.dataTransfer.files[0])}function g(e){f(e.target.files[0])}function h(e){e.preventDefault(),v(),document.execCommand("copy"),document.getElementById("confirm").innerText="✓ Text copied to clipboard.",document.getElementById("confirm").style.visibility="visible"}function b(e){document.getElementById("confirm").innerText='✓ ZIP file saved (check "Downloads" directory).',document.getElementById("confirm").style.visibility="visible"}function v(){var e=document.getElementById("latex");e.select(),e.setSelectionRange(0,999999),setTimeout((function(){e.scrollTo(0,0)}),0)}async function w(e){document.getElementById("authorization-container").style.display="none",document.getElementById("doc_list").style.display="block";const t="https://api.dropboxapi.com/2/paper/docs/list?reject_cors_preflight=true&authorization=Bearer%20"+encodeURIComponent(e),n=new TextEncoder("utf-8").encode(JSON.stringify({filter_by:"docs_accessed",sort_by:"modified",sort_order:"descending",limit:100})).buffer;try{var o;try{o=await p(t,"POST","text","text/plain; charset=dropbox-cors-hack",n)}catch(e){o=e}var r=JSON.parse(o.response)}catch{return document.getElementById("wait-document").style.display="none",void(document.getElementById("error-document").style.display="table-row")}r.error?"invalid_access_token"===r.error[".tag"]?(document.getElementById("doc_list").style.display="none",document.getElementById("authorization-container").style.display="block"):(document.getElementById("wait-document").style.display="none",document.getElementById("error-document").style.display="table-row",document.getElementById("error-document-text").innerText="An unknown error occurred."):(await Promise.all(r.doc_ids.map((t,n)=>(async function(e,t,n){var o="https://api.dropboxapi.com/2/paper/docs/download?reject_cors_preflight=true&authorization=Bearer%20"+encodeURIComponent(e)+"&arg="+encodeURIComponent(JSON.stringify({doc_id:t,export_format:"markdown"}));try{var r=await p(o,"POST","text","text/plain; charset=utf-8")}catch{console.log("Error while trying to download document meta data.")}const i=JSON.parse(r.getResponseHeader("dropbox-api-result"));B[t]={meta:i,markdown:r.response};var a=document.createElement("tr");a.classList.add("document"),a.setAttribute("data-index",n),a.setAttribute("data-docid",t);var c=document.createElement("td");c.classList.add("list_icon");var s=document.createElement("img");s.src="document.svg",c.appendChild(s),a.appendChild(c);var d=document.createElement("td");d.classList.add("list_text"),d.appendChild(document.createTextNode(i.title));var l=document.createElement("div");l.classList.add("doc_owner"),l.appendChild(document.createTextNode(i.owner)),d.appendChild(l),a.appendChild(d),a.addEventListener("click",_);const u=document.getElementById("doc_table"),m=Array.prototype.find.call(u.childNodes,e=>"TR"===e.nodeName&&e.getAttribute("data-index")>n);u.insertBefore(a,m)})(e,t,n))),document.getElementById("wait-document").style.display="none")}var _,E,x,B={};function I(){document.getElementById("choice-manual").style.display="none",document.querySelector("#choice-oauth h2").style.display="none",document.querySelector("#choice-oauth .steps").classList.add("active"),document.getElementById("confirm").style.visibility="hidden"}[_,E]=(x=null,[async function(e){e.preventDefault(),I(),x&&x.classList.remove("selected"),(x=e.currentTarget).classList.add("selected");const t=x.getAttribute("data-docid"),n=await B[t].markdown,i=await o;if(t!==x.getAttribute("data-docid"))return;const a=r.markdownToLatex(n,i);var c=document.getElementById("latex");c.value=a,setTimeout((function(){c.scrollTo(0,0)}),0)},function(e){e.preventDefault(),document.getElementById("choice-manual").style.display="block",document.getElementById("first-step-doclist").style.display="block",document.querySelector("#choice-oauth h2").style.display="block",document.querySelector("#choice-oauth .steps").classList.remove("active"),document.querySelector(".result").classList.remove("solo"),x&&x.classList.remove("selected")}]);const L=(k=null,function(e){var t=document.getElementById(location.hash.substring(1));if(t.classList.contains("highlighter")){var n=0;null!==k&&(clearTimeout(k),k=null,t.classList.remove("highlight"),n=200),setTimeout((function(){t.classList.add("highlight"),k=setTimeout((function(){k=null,t.classList.remove("highlight")}),4100)}),n),history.pushState(null,"","#")}});var k;document.addEventListener("DOMContentLoaded",(function(){window.onhashchange=L,document.getElementById("authorize").addEventListener("click",d),document.getElementById("latex").addEventListener("click",v),document.getElementById("copy").addEventListener("click",h),document.getElementById("save-zip").addEventListener("click",b),document.getElementById("back-to-start").addEventListener("click",E),document.body.addEventListener("dragover",u,!1),document.body.addEventListener("dragexit",m,!1),document.body.addEventListener("drop",y,!1),document.getElementById("files").addEventListener("change",g);const e=document.cookie.match(/(^|; ?)bluepaper_dropbox_access_tokens=([^;]+)/);if(e){document.cookie="bluepaper_dropbox_access_tokens="+e[2]+";max-age=31536000;secure;samesite=lax";const t=JSON.parse(decodeURIComponent(e[2]));w(t.tokens[t.last_used])}}))}]);